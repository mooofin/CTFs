# PostgreSQL Exploitation - picoCTF Walkthrough

## Challenge Overview
In this challenge, we are given access to a PostgreSQL database running on a remote server. Our goal is to connect to the database, explore its structure, and retrieve the flag stored within it.

## Step 1: Connecting to the PostgreSQL Database
PostgreSQL provides a command-line tool called `psql` that allows users to interact with databases. We use the following command to connect:

```bash
psql -h saturn.picoctf.net -p 56456 -U postgres pico
```

### Explanation:
- `psql` – The command-line client for PostgreSQL.
- `-h saturn.picoctf.net` – Specifies the remote host where the database server is running.
- `-p 56456` – Defines the port number (56456 in this case) on which the PostgreSQL server is listening.
- `-U postgres` – Indicates that we are logging in with the username `postgres`.
- `pico` – The name of the database we are trying to access.

Upon executing this command, we are prompted to enter a password for the `postgres` user. After successful authentication, we gain access to the `psql` shell.

---

## Step 2: Understanding the psql Interactive Shell
Once inside the PostgreSQL interactive shell, we can use various commands to explore the database. Some important commands include:

### General Help:
```sql
help;
```
This displays general help information about `psql`, including available commands and options.

### SQL Command Help:
```sql
\h
```
This provides help on SQL commands, such as `SELECT`, `INSERT`, `UPDATE`, and `DELETE`.

### psql Meta Commands:
```sql
\?
```
This lists special `psql` commands used to interact with the database, such as listing tables, querying relations, and exporting data.

---

## Step 3: Listing Available Databases
To view all databases on the server, we use the `\l` command:

```sql
\l
```

### Output:
```
                                                      List of databases
   Name    |  Owner   | Encoding | Locale Provider |  Collate   |   Ctype    | ICU Locale | ICU Rules |   Access privileges   
-----------+----------+----------+-----------------+------------+------------+------------+-----------+-----------------------
 pico      | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |            |           |
 postgres  | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |            |           |
 template0 | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |            |           | =c/postgres          +
           |          |          |                 |            |            |            |           | postgres=CTc/postgres
 template1 | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |            |           | =c/postgres          +
           |          |          |                 |            |            |            |           | postgres=CTc/postgres
(4 rows)
```

The `pico` database is our primary target since it is challenge-related.

---

## Step 4: Listing Tables in the Database
To view all tables within the connected database (`pico`), we use:

```sql
\dt
```

### Output:
```
         List of relations
 Schema | Name  | Type  |  Owner   
--------+-------+-------+----------
 public | flags | table | postgres
(1 row)
```

The database contains a table named `flags`. This table is of interest because it likely holds the challenge flag.

---

## Step 5: Retrieving Data from the Target Table
To inspect the contents of the `flags` table, we use a simple SQL `SELECT` query:

```sql
SELECT * FROM flags;
```

### Output:
```
 id | firstname | lastname  |                address                 
----+-----------+-----------+----------------------------------------
  1 | Luke      | Skywalker | picoCTF{L3arN_S0m3_5qL_t0d4Y_73b0678f}
  2 | Leia      | Organa    | Alderaan
  3 | Han       | Solo      | Corellia
(3 rows)
```

From this result, we identify the flag: `picoCTF{L3arN_S0m3_5qL_t0d4Y_73b0678f}`.

---

## Summary of Key Steps:
1. **Connect to the PostgreSQL database** using `psql`.
2. **Explore the database structure** using `\l` to list databases and `\dt` to view tables.
3. **Query the target table** using `SELECT * FROM flags;`.
4. **Extract the flag** from the retrieved data.

This challenge demonstrates fundamental SQL database enumeration and query execution skills, which are crucial for database exploitation in Capture The Flag (CTF) challenges. By leveraging built-in PostgreSQL commands, we efficiently navigated the database and retrieved the flag.

---

### Additional Notes:
- If access is restricted, consider checking for other users or privileges using `\du` (lists roles) or `\dp` (lists table permissions).
- If permissions prevent reading data, privilege escalation techniques (e.g., exploiting weak configurations) may be required.
- The knowledge gained here can be extended to SQL Injection attacks, where similar queries can be crafted dynamically to exploit vulnerable applications.

### Tools Used:
- **psql**: PostgreSQL interactive shell.
- **SQL queries**: `SELECT`, `\l`, `\dt`, `\?`, `\h`.

Flag: **`picoCTF{L3arN_S0m3_5qL_t0d4Y_73b0678f}`** ✅

---

