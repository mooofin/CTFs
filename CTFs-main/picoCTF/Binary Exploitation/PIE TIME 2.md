### PIE TIME 2 Challenge Writeup

The objective of the "PIE TIME 2" challenge is to redirect the program's execution flow to call a hidden `win` function, which then prints the flag. The primary obstacle is that the binary is compiled as a Position-Independent Executable (PIE), meaning its base address is randomized each time it runs. This prevents the use of static addresses and necessitates a method to discover the function's location at runtime.

---
### Vulnerability Analysis

A thorough analysis of the provided source code reveals two critical vulnerabilities within the `call_functions` function. The first is a format string vulnerability, originating from the insecure use of `printf(buffer);`. This allows an attacker to inject format specifiers to leak data from the stack. The second vulnerability is a direct overwrite of the instruction pointer. The program prompts the user for a memory address using `scanf("%lx", &val);` and subsequently calls this address via a function pointer, enabling arbitrary code execution if a valid address can be supplied.

---
### Exploitation Strategy

The exploit strategy involves chaining these two vulnerabilities. The format string flaw is first used as an information disclosure primitive to bypass PIE. By leaking a pointer from the stack that corresponds to a known location within the binary, such as a return address pointing back into the `main` function, a runtime reference point can be established. From this leaked address, the absolute address of the `win` function can be calculated using a static offset determined through disassembly. This final calculated address is then provided to the second prompt to hijack the program's control flow and execute the `win` function.

---
### Execution and Calculation

Static analysis of the binary using GDB reveals the necessary offsets. The `win` function begins at the static offset `0x136a`, while the instruction immediately following the `call_functions` invocation in `main` is at offset `0x1441`. The format string payload `%19$p` was identified to leak the return address pointing to this specific location. The constant offset between these two points is therefore `0x1441 - 0x136a = 0xD7`.

During a live exploit, interacting with the remote service and providing `%19$p` leaked a runtime address, for example, `0x555555555441`. By subtracting the static offset from this leaked runtime address (`0x555555555441 - 0xD7`), the absolute address of the `win` function was calculated to be `0x55555555536a`. Providing this address at the final prompt successfully redirected execution, called the `win` function, and printed the flag.
<img width="875" height="344" alt="screenshot-1752991592" src="https://github.com/user-attachments/assets/e3b18e4e-e155-4c1b-bb2e-e7985833f17a" />
![Uploading screenshot-1752991599.pngâ€¦]()



